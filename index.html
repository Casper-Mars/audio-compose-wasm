<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>WASM音频合成示例</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        .container {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        .status {
            padding: 10px;
            border-radius: 4px;
            background-color: #f0f0f0;
        }
        audio {
            width: 100%;
            margin: 10px 0;
        }
        .download-link {
            display: inline-block;
            padding: 10px 20px;
            background-color: #4CAF50;
            color: white;
            text-decoration: none;
            border-radius: 4px;
        }
        .download-link:hover {
            background-color: #45a049;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>WASM音频合成示例</h1>
        <div id="status" class="status">初始化中...</div>
    </div>
    
    <script type="module">
        import init, { synthesize_audio } from './pkg/wasm.js';
        
        async function run() {
            await init();
            
            const status = document.getElementById('status');
            status.textContent = 'WASM模块已加载';
            
            // 音频片段数据
            const audioSegments = [
                {
                    "id": "341098623408192255",
                    "url": "https://cdn-allvoice-down-testing.funnycp.com/allvoice/translate-saas-test/public/videotranslate/267739879855620128/2025-02-10/270243296838681150/54141dd6-7ebc-4de2-aa8c-758d00ff587e_generate_audio.mp3",
                    "start_time": "00:00:01,466",
                    "end_time": "00:00:02,828"
                },
                {
                    "id": "3633002812117896102",
                    "url": "https://cdn-allvoice-down-testing.funnycp.com/allvoice/translate-saas-test/public/videotranslate/267739879855620128/2025-02-08/270243296838681150/4c750184-2c93-449b-805b-909100a8616a_generate_audio.mp3",
                    "start_time": "00:00:02,308",
                    "end_time": "00:00:03,266"
                },
                {
                    "id": "3455378716628597555",
                    "url": "https://cdn-allvoice-down-testing.funnycp.com/translate-saas-test/public/audio-clone/267739879855620130/20250207/110/full_vocal_14d08dbc-26c8-47a8-82f5-8a26eadaade2_002_20250207160402_tts.wav",
                    "start_time": "00:00:13,442",
                    "end_time": "00:00:14,622"
                },
                {
                    "id": "3860057685314390746",
                    "url": "https://cdn-allvoice-down-testing.funnycp.com/allvoice/translate-saas-test/public/videotranslate/267739879855620128/2025-02-07/270243296838681150/58e1a06d-95f3-4e98-8e0b-2e26a3d535c5_generate_audio.mp3",
                    "start_time": "00:00:14,983",
                    "end_time": "00:00:15,903"
                }
            ];
            
            try {
                status.textContent = '开始合成音频...';
                
                // 调用WASM函数合成音频
                const base64Audio = await synthesize_audio(JSON.stringify(audioSegments));
                status.textContent = '音频合成完成！';
                
                // 将Base64音频数据转换为Blob
                const byteCharacters = atob(base64Audio);
                const byteNumbers = new Array(byteCharacters.length);
                for (let i = 0; i < byteCharacters.length; i++) {
                    byteNumbers[i] = byteCharacters.charCodeAt(i);
                }
                const byteArray = new Uint8Array(byteNumbers);
                const audioBlob = new Blob([byteArray], { type: 'audio/mp3' });
                
                // 创建音频URL并播放
                const audioUrl = URL.createObjectURL(audioBlob);
                const audioElement = new Audio(audioUrl);
                audioElement.controls = true;
                document.querySelector('.container').appendChild(audioElement);
                
                // 提供下载链接
                const downloadLink = document.createElement('a');
                downloadLink.href = audioUrl;
                downloadLink.download = 'synthesized_audio.mp3';
                downloadLink.textContent = '下载合成的音频';
                downloadLink.className = 'download-link';
                document.querySelector('.container').appendChild(downloadLink);
                
            } catch (error) {
                status.textContent = `音频合成失败: ${error}`;
                console.error('音频合成失败:', error);
            }
        }
        
        // 页面加载完成后运行示例
        window.addEventListener('DOMContentLoaded', run);
    </script>
</body>
</html>